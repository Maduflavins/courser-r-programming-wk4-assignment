"0","rankall <- function(outcome, num = ""best"") {"
"0","    outcomes <- c(""heart attack"", ""heart failure"", ""pneumonia"")"
"0","    "
"0","    if (!(outcome %in% outcomes)) {"
"0","        stop(""invalid outcome"")"
"0","    }"
"0","    "
"0","    df <- read.csv(""outcomes.csv"", colClasses = c(Hospital.30.Day.Death..Mortality..Rates.from.Heart.Attack = ""character"", "
"0","        Hospital.30.Day.Death..Mortality..Rates.from.Heart.Failure = ""character"", "
"0","        Hospital.30.Day.Death..Mortality..Rates.from.Pneumonia = ""character"", "
"0","        Hospital.Name = ""character""))"
"0","    "
"0","    # convert ratings to numeric"
"0","    df[, 11] <- suppressWarnings(as.numeric(df[, 11]))"
"0","    df[, 17] <- suppressWarnings(as.numeric(df[, 17]))"
"0","    df[, 23] <- suppressWarnings(as.numeric(df[, 23]))"
"0","    "
"0","    # Create a subset dataframe for given outcome"
"0","    if (outcome == ""heart attack"") {"
"0","        df1 <- df[, c(2, 7, 11)]"
"0","    } else if (outcome == ""heart failure"") {"
"0","        df1 <- df[, c(2, 7, 17)]"
"0","    } else if (outcome == ""pneumonia"") {"
"0","        df1 <- df[, c(2, 7, 23)]"
"0","    }"
"0","    "
"0","    # Rename Column name of Hospital name to Hospital"
"0","    names(df1)[1] <- ""hospital"""
"0","    names(df1)[2] <- ""state"""
"0","    names(df1)[3] <- ""Rate"""
"0","    "
"0","    # Remove rows where Ratings are not known."
"0","    df1 <- df1[!is.na(df1$Rate), ]"
"0","    # head(df1)"
"0","    "
"0","    library(table)"
"0","    dt <- as.table(df1[, c(""hospital"", ""state"", ""Rate"")])"
"0","    # head(dt) Add ranking to the table dt1 <- dt[,list(hospital, rank ="
"0","    # rank(Rate,ties.method = 'first')), by = state]"
"0","    setkey(dt, state, Rate)"
"0","    dt1 <- dt[, list(hospital, rank = rank(Rate, ties.method = ""random"")), by = state]"
"0","    # dt1 <- dt[,list(hospital, Rate, rank = rank(Rate,ties.method = 'last')),"
"0","    # by = state]"
"0","    "
"0","    # ======================="
"0","    if (num == ""best"") {"
"0","        dt2 <- dt1[, list(rank = 1), by = state]"
"0","    } else if (num == ""worst"") {"
"0","        dt2 <- dt1[, list(rank = max(rank)), by = state]"
"0","    } else {"
"0","        dt2 <- dt1[, list(rank = num), by = state]"
"0","    }"
"0","    # ======================="
"0","    setkey(dt2, state, rank)"
"0","    setkey(dt1, state, rank)"
"0","    return(as.data.frame(dt1[dt2, ][, list(hospital, state, rank)]))"
"0","}"
